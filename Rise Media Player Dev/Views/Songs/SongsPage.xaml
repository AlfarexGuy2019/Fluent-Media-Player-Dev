<uc:MediaPageBase
    x:Class="Rise.App.Views.SongsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:animations="using:Microsoft.Toolkit.Uwp.UI.Animations"
    xmlns:app="using:Rise.App"
    xmlns:conv="using:Rise.App.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:tkitui="using:Microsoft.Toolkit.Uwp.UI"
    xmlns:uc="using:Rise.App.UserControls"
    xmlns:viewmodels="using:Rise.App.ViewModels"
    x:Name="PageRoot"
    d:Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    d:DesignHeight="320"
    d:DesignWidth="500"
    Loaded="OnPageLoaded"
    mc:Ignorable="d">

    <uc:MediaPageBase.Resources>
        <conv:BooleanToVisibility x:Key="BoolToVis" />
        <conv:NullToBoolean x:Key="NullToBool" />

        <conv:ResourceToString x:Key="StrToRes" />
    </uc:MediaPageBase.Resources>

    <Grid Padding="56,56,56,0" d:Padding="20,12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="1*" />
        </Grid.RowDefinitions>

        <muxc:TeachingTip
            x:Name="DiscyOnSong"
            Title="Taking action on songs"
            ActionButtonContent="Learn more"
            CloseButtonContent="Got it!"
            IsLightDismissEnabled="True"
            PlacementMargin="20"
            PreferredPlacement="Auto"
            Subtitle="Hover over a song and click the play button to play a song, or double click. Skip, go back and view song info from the now playing bar (at the bottom of your app window). Click 'Info and Properties' to edit song metadata and file information. You can always share to others or add to a playlist too!">
            <muxc:TeachingTip.HeroContent>
                <Image Source="/Assets/Branding/discygraphic.png" />
            </muxc:TeachingTip.HeroContent>
        </muxc:TeachingTip>

        <TextBlock
            d:Text="Songs"
            Style="{StaticResource TitleTextBlockStyle}"
            Text="{x:Bind Label, Converter={StaticResource StrToRes}, ConverterParameter=Sidebar}" />
        <CommandBar
            Grid.Row="1"
            Margin="-12,0"
            HorizontalAlignment="Left"
            Background="Transparent"
            DefaultLabelPosition="Right">
            <AppBarButton
                x:Uid="/Information/Play"
                Command="{x:Bind MediaViewModel.PlayFromItemCommand}"
                CommandParameter="{x:Bind SelectedItem, Mode=OneWay}"
                Icon="Play"
                Style="{StaticResource AppBarCompactButtonStyle}" />

            <AppBarSeparator />

            <AppBarButton
                x:Uid="/Information/Shuffle"
                Command="{x:Bind MediaViewModel.ShuffleFromItemCommand}"
                CommandParameter="{x:Bind SelectedItem, Mode=OneWay}"
                Icon="Shuffle" />
            <AppBarButton x:Uid="/Information/Add" IsEnabled="{x:Bind SelectedItem, Converter={StaticResource NullToBool}, Mode=OneWay}">
                <AppBarButton.Icon>
                    <FontIcon Glyph="&#xECC8;" />
                </AppBarButton.Icon>

                <AppBarButton.Flyout>
                    <MenuFlyout x:Name="AddToBar">
                        <MenuFlyoutItem x:Uid="/Information/NewPlaylist" Command="{x:Bind PlaylistHelper.AddToPlaylistCommand}">
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="ms-appx:///Assets/MediaPlayerIcons.ttf#Media Player Fluent Icons" Glyph="&#xE93F;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                    </MenuFlyout>
                </AppBarButton.Flyout>
            </AppBarButton>

            <AppBarSeparator />

            <AppBarButton
                x:Uid="/Information/Delete"
                Click="Remove_Click"
                Icon="Delete"
                IsEnabled="{x:Bind SelectedItem, Converter={StaticResource NullToBool}, Mode=OneWay}"
                Style="{StaticResource AppBarCompactButtonStyle}" />
            <AppBarButton
                x:Uid="/Information/Edit"
                Command="{x:Bind EditItemCommand}"
                CommandParameter="{x:Bind SelectedItem, Mode=OneWay}"
                Icon="Edit"
                IsEnabled="{x:Bind SelectedItem, Converter={StaticResource NullToBool}, Mode=OneWay}"
                Style="{StaticResource AppBarCompactButtonStyle}" />

            <AppBarSeparator />

            <AppBarButton Click="PlayFromUrl_Click" Label="Play from URL">
                <AppBarButton.Icon>
                    <FontIcon Glyph="&#xE704;" />
                </AppBarButton.Icon>
            </AppBarButton>

            <AppBarSeparator />

            <AppBarButton x:Uid="/Information/View">
                <AppBarButton.Icon>
                    <FontIcon Glyph="&#xECAA;" />
                </AppBarButton.Icon>

                <AppBarButton.Flyout>
                    <MenuFlyout>
                        <ToggleMenuFlyoutItem IsChecked="{x:Bind SViewModel.ShowTrackNumberInSongs, Mode=TwoWay}" Text="Track number" />
                        <ToggleMenuFlyoutItem IsChecked="{x:Bind SViewModel.ShowDurationInSongs, Mode=TwoWay}" Text="Duration" />
                    </MenuFlyout>
                </AppBarButton.Flyout>
            </AppBarButton>

            <AppBarButton x:Uid="/Information/Sort" Icon="Sort">
                <AppBarButton.Flyout>
                    <MenuFlyout>
                        <muxc:RadioMenuFlyoutItem
                            x:Uid="/Information/Track"
                            Command="{x:Bind MediaViewModel.SortByCommand}"
                            CommandParameter="Track" />
                        <muxc:RadioMenuFlyoutItem
                            x:Uid="/Information/Title"
                            Command="{x:Bind MediaViewModel.SortByCommand}"
                            CommandParameter="Title" />
                        <muxc:RadioMenuFlyoutItem
                            x:Uid="/Information/Album"
                            Command="{x:Bind MediaViewModel.SortByCommand}"
                            CommandParameter="Album" />
                        <muxc:RadioMenuFlyoutItem
                            x:Uid="/Information/Artist"
                            Command="{x:Bind MediaViewModel.SortByCommand}"
                            CommandParameter="Artist" />
                        <muxc:RadioMenuFlyoutItem
                            x:Uid="/Information/Genre"
                            Command="{x:Bind MediaViewModel.SortByCommand}"
                            CommandParameter="Genres" />
                        <muxc:RadioMenuFlyoutItem
                            x:Uid="/Information/Year"
                            Command="{x:Bind MediaViewModel.SortByCommand}"
                            CommandParameter="Year" />

                        <MenuFlyoutSeparator />

                        <muxc:RadioMenuFlyoutItem
                            x:Uid="/Information/Ascending"
                            Command="{x:Bind MediaViewModel.UpdateSortDirectionCommand}"
                            CommandParameter="{x:Bind tkitui:SortDirection.Ascending}"
                            GroupName="SortDirection" />
                        <muxc:RadioMenuFlyoutItem
                            x:Uid="/Information/Descending"
                            Command="{x:Bind MediaViewModel.UpdateSortDirectionCommand}"
                            CommandParameter="{x:Bind tkitui:SortDirection.Descending}"
                            GroupName="SortDirection" />
                    </MenuFlyout>
                </AppBarButton.Flyout>
            </AppBarButton>

            <AppBarSeparator />

            <AppBarButton
                x:Uid="/MediaLibrary/AddFolders"
                HorizontalAlignment="Right"
                Click="AddFolders_Click"
                Icon="NewFolder" />
        </CommandBar>

        <ListView
            x:Name="MainList"
            Grid.Row="2"
            Margin="-56,0"
            Padding="44,0,44,120"
            DoubleTapped="MainList_DoubleTapped"
            IsDoubleTapEnabled="True"
            ItemsSource="{x:Bind MediaViewModel.Items}"
            SelectedItem="{x:Bind SelectedItem, Mode=TwoWay}"
            SelectionMode="Single">
            <ListView.ContextFlyout>
                <MenuFlyout Opening="MenuFlyout_Opening">
                    <MenuFlyoutItem
                        x:Uid="/Information/PlayItem"
                        Command="{x:Bind MediaViewModel.PlayFromItemCommand}"
                        CommandParameter="{x:Bind SelectedItem, Mode=OneWay}"
                        Icon="Play" />

                    <MenuFlyoutItem
                        x:Uid="/Information/ShowAlbum"
                        Command="{x:Bind GoToAlbumCommand}"
                        CommandParameter="{x:Bind SelectedItem.Album, Mode=OneWay}">
                        <MenuFlyoutItem.Icon>
                            <FontIcon Glyph="&#xE93C;" />
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>

                    <MenuFlyoutItem
                        x:Uid="/Information/ShowArtist"
                        Command="{x:Bind GoToArtistCommand}"
                        CommandParameter="{x:Bind SelectedItem.Artist, Mode=OneWay}"
                        Icon="People" />

                    <MenuFlyoutSeparator />

                    <MenuFlyoutSubItem x:Name="AddTo" x:Uid="/Information/AddTo">
                        <MenuFlyoutSubItem.Icon>
                            <FontIcon Glyph="&#xECC8;" />
                        </MenuFlyoutSubItem.Icon>

                        <MenuFlyoutItem x:Uid="/Information/NewPlaylist" Command="{x:Bind PlaylistHelper.AddToPlaylistCommand}">
                            <MenuFlyoutItem.Icon>
                                <FontIcon FontFamily="ms-appx:///Assets/MediaPlayerIcons.ttf#Media Player Fluent Icons" Glyph="&#xE93F;" />
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                    </MenuFlyoutSubItem>

                    <MenuFlyoutItem
                        x:Uid="/Information/Share"
                        Icon="Share"
                        IsEnabled="False" />

                    <MenuFlyoutSeparator />

                    <MenuFlyoutItem
                        x:Uid="/Information/AskDiscy"
                        Click="AskDiscy_Click"
                        Icon="Help" />

                    <MenuFlyoutItem
                        x:Uid="/Information/ShowinFE"
                        Command="{x:Bind OpenInExplorerCommand}"
                        CommandParameter="{x:Bind SelectedItem, Mode=OneWay}">
                        <MenuFlyoutItem.Icon>
                            <FontIcon Glyph="&#xEC50;" />
                        </MenuFlyoutItem.Icon>
                    </MenuFlyoutItem>

                    <MenuFlyoutSeparator />

                    <MenuFlyoutItem
                        x:Uid="/Information/RemoveThing"
                        Click="Remove_Click"
                        Icon="Delete" />

                    <MenuFlyoutItem
                        x:Uid="/MediaData/Properties"
                        Command="{x:Bind EditItemCommand}"
                        CommandParameter="{x:Bind SelectedItem, Mode=OneWay}"
                        Icon="Edit" />
                </MenuFlyout>
            </ListView.ContextFlyout>

            <ListView.ItemContainerStyle>
                <Style BasedOn="{StaticResource DefaultListViewItemStyle}" TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                </Style>
            </ListView.ItemContainerStyle>

            <ListView.ItemTemplate>
                <DataTemplate x:DataType="viewmodels:SongViewModel" x:DefaultBindMode="OneWay">
                    <Border
                        Margin="-12,2,-10,2"
                        Padding="4,0"
                        HorizontalAlignment="Stretch"
                        Style="{StaticResource SettingsCard}">
                        <Grid
                            Margin="4,0,0,0"
                            Background="Transparent"
                            ColumnSpacing="12"
                            PointerCanceled="Grid_PointerExited"
                            PointerEntered="Grid_PointerEntered"
                            PointerExited="Grid_PointerExited">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Margin="4,0,0,0" Orientation="Horizontal">
                                <Button
                                    Grid.Column="1"
                                    Width="32"
                                    Height="32"
                                    Margin="0,0,12,0"
                                    Padding="0"
                                    CornerRadius="7"
                                    IsHitTestVisible="False"
                                    Style="{StaticResource TransparentButtonStyle}"
                                    Visibility="{x:Bind app:App.SViewModel.ShowTrackNumberInSongs}">
                                    <Border
                                        x:Name="AlbumNum"
                                        Width="32"
                                        Height="32"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        CornerRadius="3">
                                        <TextBlock
                                            Width="24"
                                            Margin="0,-2,0,0"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Center"
                                            Text="{x:Bind Track}"
                                            TextAlignment="Center" />
                                    </Border>
                                </Button>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <Button
                                        x:Uid="/Information/Play"
                                        Width="36"
                                        Height="36"
                                        Margin="-2,0,-2,0"
                                        Padding="0"
                                        Command="{Binding MediaViewModel.PlayFromItemCommand, ElementName=PageRoot, Mode=OneTime}"
                                        CommandParameter="{x:Bind}"
                                        Style="{StaticResource TransparentButtonStyle}"
                                        Visibility="{x:Bind IsFocused}">
                                        <FontIcon FontSize="16" Glyph="&#xE102;" />
                                    </Button>
                                </StackPanel>

                                <Button
                                    Grid.Column="1"
                                    Width="32"
                                    Height="32"
                                    Margin="0,-8,-8,-8"
                                    Padding="0"
                                    CornerRadius="7"
                                    IsHitTestVisible="False"
                                    Visibility="{x:Bind IsFocused, Converter={StaticResource BoolToVis}, ConverterParameter=Reverse}">
                                    <Border
                                        x:Name="AlbumThumb"
                                        Width="32"
                                        Height="32"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        CornerRadius="3">
                                        <Image Width="32" Height="32">
                                            <Image.Source>
                                                <BitmapImage
                                                    DecodePixelHeight="32"
                                                    DecodePixelType="Logical"
                                                    DecodePixelWidth="32"
                                                    UriSource="{x:Bind Thumbnail}" />
                                            </Image.Source>
                                        </Image>
                                    </Border>
                                </Button>
                            </StackPanel>

                            <RelativePanel Grid.Column="2" VerticalAlignment="Center">
                                <TextBlock
                                    x:Name="SongTitle"
                                    MaxLines="2"
                                    Text="{x:Bind Title}"
                                    TextTrimming="CharacterEllipsis"
                                    TextWrapping="WrapWholeWords" />
                                <HyperlinkButton
                                    x:Name="ArtistName"
                                    Margin="16,0,0,0"
                                    Padding="0"
                                    Command="{Binding GoToArtistCommand, ElementName=PageRoot, Mode=OneTime}"
                                    CommandParameter="{x:Bind Artist}"
                                    FontSize="14"
                                    FontWeight="SemiBold"
                                    RelativePanel.RightOf="SongTitle">
                                    <TextBlock Text="{x:Bind Artist}" TextTrimming="CharacterEllipsis" />
                                </HyperlinkButton>

                                <TextBlock
                                    x:Name="Pill"
                                    Margin="8,0,0,0"
                                    RelativePanel.RightOf="ArtistName"
                                    Text="•" />

                                <HyperlinkButton
                                    Margin="8,0,0,0"
                                    Padding="0"
                                    Command="{Binding GoToAlbumCommand, ElementName=PageRoot, Mode=OneTime}"
                                    CommandParameter="{x:Bind Album}"
                                    FontSize="14"
                                    FontWeight="SemiBold"
                                    RelativePanel.RightOf="Pill">
                                    <TextBlock Text="{x:Bind Album}" TextTrimming="CharacterEllipsis" />
                                </HyperlinkButton>
                            </RelativePanel>

                            <StackPanel
                                Grid.Column="3"
                                Orientation="Horizontal"
                                Spacing="4">
                                <Button
                                    x:Name="PropsHover"
                                    x:Uid="/Information/Props"
                                    Width="36"
                                    Height="36"
                                    Padding="0"
                                    Command="{Binding EditItemCommand, ElementName=PageRoot, Mode=OneTime}"
                                    CommandParameter="{x:Bind}"
                                    Style="{StaticResource TransparentButtonStyle}"
                                    Visibility="{x:Bind IsFocused}">
                                    <FontIcon FontSize="16" Glyph="&#xE104;" />
                                </Button>

                                <TextBlock
                                    Margin="12"
                                    VerticalAlignment="Center"
                                    Text="{x:Bind Length, Converter={StaticResource TimeToStr}}"
                                    Visibility="{x:Bind app:App.SViewModel.ShowDurationInSongs}" />
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</uc:MediaPageBase>
